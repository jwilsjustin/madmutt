define(["aloha/jquery","aloha/plugin","ui/ui","ui/button","i18n!aloha/nls/i18n","i18n!locomotive_media/nls/i18n","css!locomotive_media/css/image.css"],function(e,t,n,r,i,s){var o=e,u=e,a=window.GENTICS,f=window.Aloha;return t.create("locomotive_media",{init:function(){this._addUIInsertButton()},openDialog:function(){var e=this,t=window.parent.application_view.content_assets_picker_view;t.options.on_select=function(n){n.get("image")==1?e.insertImg(n):e.insertLink(n),t.close()},t.fetch_assets()},insertImg:function(e){var t=f.Selection.getRangeObject(),n=e.get("url"),r,i,s;t.isCollapsed()?(r="max-width: "+e.get("width")+"; max-height: "+e.get("height"),i='<img style="'+r+'" src="'+n+'" title="" />',s=o(i),a.Utils.Dom.insertIntoDOM(s,t,o(f.activeEditable.obj))):f.Log.error("media cannot markup a selection")},insertLink:function(e){var t=f.Selection.getRangeObject(),n=e.get("filename"),r=e.get("url"),i,s;t.isCollapsed()?(i='<a href="'+r+'">'+n+"</a>",s=o(i),a.Utils.Dom.insertIntoDOM(s,t,o(f.activeEditable.obj)),t.startContainer=t.endContainer=s.contents().get(0),t.startOffset=0,t.endOffset=n.length):(i='<a href="'+r+'"></a>',s=o(i),a.Utils.Dom.addMarkup(t,s,!1))},_addUIInsertButton:function(){var e=this,t=n.adopt("insertlocomotivemedia",r,{tooltip:s.t("button.addimg.tooltip"),icon:"aloha-button aloha-locomotive-media-insert",scope:"Aloha.continuoustext",click:function(){e.openDialog()}})}})});